@model PPWLib.Models.Item.ReserveEditModel

@{
	ViewBag.Title = string.Format(Resources.Resource.EditFormat, string.Format(Resources.Resource.OrderFormat, Resources.Resource.Reserve));
	int rand = CommonHelper.GetVersionRandomNo();
	var Reserve = Model.ReserveLnList.FirstOrDefault();
}
<link href="~/Content/item/reserve/edit.css?v=@rand" rel="stylesheet" type="text/css" />

<h2 class="mb-4">@ViewBag.Title</h2>


@Html.AntiForgeryToken()

<div class="clearfix">
	<div class="float-right">
		<span>@Resources.Resource.OrderNo <span class="badge badge-dark">@Reserve.riCode</span></span>
		<span>@Resources.Resource.Date <span class="badge badge-dark">@Reserve.ReserveDateDisplay</span></span>
	</div>
</div>

<form class="form-inline">
	<div class="form-group">
		<label class="mx-2">@Resources.Resource.Customer</label>
		<input id="txtCustomerName" class="form-control" readonly value="@Reserve.CustomerName" title="@Reserve.CustomerName">
	</div>
	<div class="form-group mx-2">
		<label class="mx-2">@Resources.Resource.Remark</label>
		<input id="txtRemark" class="form-control" readonly value="@Reserve.RemarkDisplay" data-remark="@Reserve.riRemark" title="@Reserve.riRemark">
	</div>
	<a id="btnEdit" href="#" role="button" class="btn btn-warning mx-1" data-orderid="@Reserve.OrderId">@Resources.Resource.Edit</a>
</form>
<span id="saveMsg" class=""></span>

@Html.Partial("_ReserveModal", null, new ViewDataDictionary { { "CustomerList", Model.CustomerList }, { "Reserve",Reserve } })

<div class="d-flex justify-content-center my-2">
	<table id="tblEdit" class="table table-bordered table-hover overflow-auto">
		<thead class="gray-header">
			<tr>
				<th class="text-center sender">@Resources.Resource.Warehouse</th>
				<th class="text-center itemcode">@Resources.Resource.ItemCode</th>
				<th class="text-center itemdesc">@Resources.Resource.Name/@Resources.Resource.Description</th>
				<th class="text-right itemprice">@Resources.Resource.SellingPrice (@Model.Currency)</th>
				<th class="text-center itemoptions">@Resources.Resource.Batch|@Resources.Resource.SerialNo|@Resources.Resource.ExpiryDate</th>
				<th class="text-center itemvari">@Resources.Resource.ItemVariations</th>

				<th class="text-right"><span class="font-weight-bold onhandstock">@Resources.Resource.OnHandStock</span></th>
				@foreach (var _shop in Model.ShopNames)
				{
					<th class="text-right locqty">@_shop</th>
				}
				<th class="text-right rqty"><span class="font-weight-bold">@Resources.Resource.ReservedQty</span></th>
				<th></th>
			</tr>
		</thead>
		<tbody>
			@foreach (var line in Model.ReserveLnList)
			{
				var namedesctxt = line.ItemNameDesc.Length > 40 ? line.ItemNameDesc.Substring(0, 40) + "..." : line.ItemNameDesc;
				var item = Model.ItemList.FirstOrDefault(x => x.itmCode == line.itmCode);
				<tr>
					<td class="text-center sender" title="@line.rilSender">@line.rilSender</td>
					<td class="text-center linecode" title="@line.itmCode">
						@line.itmCode
					</td>
					<td class="text-center linedesc" title="@line.ItemNameDesc">
						@namedesctxt
					</td>
					<td class="text-right lineprice">
						<input type="text" class="form-control number text-right lineprice" value="@line.SellingPriceDisplay" />
					</td>
					<td class="text-center itemoptions">@Html.Raw(item.ItemOptionsDisplay)</td>
					<td class="text-center itemvari">@Html.Raw(item.ItemVariationsDisplay)</td>


					<td class="text-right onhandstock @item.OutOfStockCls" title="@item.QuantityAvailable">@item.QuantityAvailable</td>

					@foreach (var shop in Model.Shops)
					{
						int isprimary = Model.PrimaryLocation == shop ? 1 : 0;
						int qty = 0;
						string Id = "";
						if (Model.DicCodeLocQty.ContainsKey(item.itmCode) && Model.DicCodeLocQty[item.itmCode].ContainsKey(shop))
						{
							qty = Model.DicCodeLocQty[item.itmCode][shop];
						}
						if (Model.DicCodeLocId.ContainsKey(item.itmCode) && Model.DicCodeLocId[item.itmCode].ContainsKey(shop))
						{
							Id = Model.DicCodeLocId[item.itmCode][shop];
						}
						<td class="text-right locqty">
							<input type="text" class="form-control text-right btnsmall locqty number" data-id="@Id" data-isprimary="@isprimary" data-code="@item.itmCode" data-shop="@shop" data-onhandstock="@qty" data-oldval="@qty" data-itemid="@item.itmItemID" value="@qty" title="@qty">
						</td>
					}
				
					<td class="text-right locqty">
						<input type="number" class="form-control btnsmall text-right rilqty" value="@line.rilQty" />					
					</td>
					<td class="text-center">
						<button type="button" class="btn btn-success save" data-id="@line.Id">@Resources.Resource.Save</button>
					</td>
				</tr>
			}
		</tbody>
	</table>
</div>

<div class="clearfix">
	<button id="btnPaidOut" class="btn btn-primary float-right" data-orderid="@Reserve.OrderId">@Resources.Resource.PayNow</button>
</div>

@Html.Partial("_WaitingModal")
@Html.Partial("_TextAreaModal")

<div id="infoblk"></div>

<script src="~/Scripts/ts/js/item/reserve/edit.js?v=@rand"></script>


