@model OneDriveEditModel
@using PagedList.Mvc;
@{
    ViewBag.Title = Resources.Resource.Document;
    var rand = CommonHelper.GetVersionRandomNo();
    var totaltxt = CultureHelper.CurrentCulture == 2 ? string.Concat(Resources.Resource.Total, " ", Resources.Resource.Record, "s") : String.Concat(Resources.Resource.Total, "", Resources.Resource.Record);

    var daterange = string.Concat("<strong>", Model.StartDateDisplay, "</strong>", $" {Resources.Resource.To} ", "<strong>", Model.EndDateDisplay, "</strong>");
    var filelnkcopiedtxt = string.Format(Resources.Resource.CopiedFormat, string.Format(Resources.Resource.FileFormat, Resources.Resource.Link));
    var icount = Model.PagingDocumentList.Count;
}
<link href="~/Scripts/paginationjs/pagination.css" rel="stylesheet" type="text/css" />
<link href="~/Content/onedrive.css?v=@rand" rel="stylesheet" type="text/css" />

<h2>@ViewBag.Title</h2>

<div id="norecordfound" class="container hide">@Resources.Resource.NoDataFound</div>
@using (Html.BeginForm("Index", "OneDrive", FormMethod.Post, new { @id = "frmonedrive" }))
{
    <div class="container-fluid" style="width:105%;" data-authority="@Model.Settings.gsAuthority" data-count="@Model.PagingDocumentList.Count">
        @*@using (Html.BeginForm("Index", "OneDrive", FormMethod.Post, new { @id = "frmonedrive" }))
            {*@
        <div class="row justify-content-center py-3 px-3">
            @Html.Partial("_DatesRange", null, new ViewDataDictionary { { "DateFromTxt", Model.DateFromTxt }, { "DateToTxt", Model.DateToTxt } })
        </div>

        <div class="row justify-content-around mb-2">
            <!-- don't use submit button below!!!-->
            <button id="btnFilter" type="button" class="btn btn-success mr-sm-3">@Resources.Resource.Submit</button>
            <a href="#" role="button" class="btn btn-info" id="btnReload">@Resources.Resource.Reload</a>
        </div>        
    </div>

    <hr />

    <div class="container-fluid" style="width:105%;">
        <div id="searchblk" class="row justify-content-center form-inline mb-2 my-4">
            <form id="frmonedrive">
                <div class="form-group">
                    <input type="text" class="form-control" id="txtKeyword" name="Keyword" placeholder="@Resources.Resource.KeywordRequired" value="@Model.Keyword" />
                    <button id="btnSearch" type="submit" role="button" class="btn btn-primary ml-4">@Resources.Resource.Search</button>
                    <button id="btnReset" type="button" role="button" class="btn btn-secondary ml-4">@Resources.Resource.Reset</button>
                </div>
            </form>
        </div>
    </div>
}


<div class="my-5" style="width:105%;">
    <div class="container">
        <div class="row justify-content-between">
            <div class="mt-auto"><span id="datetxt">@Html.Raw(daterange)</span></div>

            <div class="mt-auto"><span>@totaltxt: <span id="totalcount" class="font-weight-bold">@icount</span></span></div>

            <div class="d-flex" style="margin-right:-8em;">
                <div class="justify-content-end">
                    <div class="form-inline">
                        <div class="form-group">
                            <label for="iPageSize" style="margin-bottom:-1em;">@Resources.Resource.RecordsPerPage: </label>
                            <input type="number" class="form-control ml-2" id="iPageSize" placeholder="" value="@Model.PageSize" style="width:25%;" min="@Model.PageSize" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="clearfix"></div>
    <table id="tblonedrive" class="table table-bordered  table-hover table-condensed">
        <thead class="gray-header">
            <tr>
                <th scope="col">@Resources.Resource.Name</th>
                <th scope="col">@string.Format(Resources.Resource.DateFormat, Resources.Resource.Upload)</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @if (Model.PagingDocumentList.Count > 0)
            {
                foreach (var e in Model.PagingDocumentList)
                {
                    var tagfile = $"<a href='{e.odFileWebUrl}' class='filelnk' target='_blank'>{e.odFileName}</a>";
                    <tr class="onedrive" role="button" data-id="@e.Id">
                        <td>@Html.Raw(tagfile)</td>
                        <td>@e.odUploadTimeDisplay</td>
                        <td style="width:120px;max-width:120px;"><button type="button" role="button" class="btn btn-primary getlink" data-id="@e.Id" data-link="@e.odFileWebUrl">@Resources.Resource.GetLink</button> </td>
                    </tr>
                }
            }

        </tbody>
    </table>
    <div id="pagingblk" class="mx-3">
        <div class="row">
            @Html.PagedListPager(Model.PagingDocumentList, PageNo => Url.Action("Index",
new { PageNo, SortOrder = Model.CurrentSortOrder, Keyword = Model.Keyword, PageSize = Model.PageSize }))
        </div>
    </div>

    <input type="hidden" name="SortOrder" id="sortorder" value="@Model.SortOrder" />
    <input type="hidden" id="sortcol" value="@Model.SortCol" />
    @*<input type="hidden" id="keyword" value="@Model.Keyword" />*@
    <input type="hidden" id="pageno" value="@Model.PageNo" />

    <div id="pagination-onedrive"></div>
</div>

@Html.AntiForgeryToken()

@Html.Partial("_WaitingModal")

<input type="hidden" id="copyboard" />

<div id="infoblk" class="hide" data-fromtxt="@Resources.Resource.From" data-totxt="@Resources.Resource.To" data-todaytxt="@Resources.Resource.Today" data-edittxt="@Resources.Resource.Edit" data-pagesize="@ConfigurationManager.AppSettings["OneDrivePageSize"]" data-pagesizenoltzerotxt="@string.Format(Resources.Resource.NoLtZero, Resources.Resource.RecordsPerPage)" data-authority="@Model.Settings.gsAuthority" data-clientid="@Model.Settings.gsClientId" data-redirecturi="@Model.Settings.gsRedirectUri" data-tenantid="@Model.Settings.gsTenantId" data-getlinktxt="@Resources.Resource.GetLink" data-filelnkcopiedtxt="@filelnkcopiedtxt"></div>

<script type="text/javascript" src="~/Scripts/daterangepicker/moment.min.js"></script>
<script type="text/javascript" src="~/Scripts/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="~/Scripts/daterangepicker/daterangepicker.css" />

<script src="~/Scripts/paginationjs/pagination.js"></script>

 <script src="https://alcdn.msauth.net/browser/2.1.0/js/msal-browser.min.js"
    integrity="sha384-EmYPwkfj+VVmL1brMS1h6jUztl4QMS8Qq8xlZNgIT/luzg7MAzDVrRa2JxbNmk/e"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@Html.Raw("@")microsoft/microsoft-graph-client/lib/graph-js-sdk.js"></script>

<script src="~/Scripts/msgraph/auth.js?v=@rand"></script>
<script src="~/Scripts/date.format.js"></script>
<script src="~/Scripts/msgraph/onedrive/graph.js?v=@rand"></script>
<script src="~/Scripts/ts/js/crm/onedrive/onedrive.js?v=@rand"></script>
<script src="~/Scripts/msgraph/onedrive/ui.js?v=@rand"></script>
